% Some general macros I tend to reuse in most documents
%
% One day I'll figure out how to write proper TeX packages.
%

%======================================================================
% List environments with tighter spacing
%

\newenvironment{tight_itemize}{
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
}{\end{itemize}}

\newenvironment{tight_enumerate}{
\begin{enumerate}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
}{\end{enumerate}}



%======================================================================
% Email links
%

\newcommand{\emailhref}[1]{\href{mailto:#1}{#1}}


%======================================================================
% Customized todo notes
%
% Built on: todonotes
%

% towrite / written
% Write points that need to be made in a "towrite", then change to "written"
% when its done.
% Add `final` to the document to disable all.
\newcommand\towrite[1]{
    \todo[inline,color=white,bordercolor=white]{\textcolor{blue}{Write: #1}}
}
\newcommand\written[1]{%
    \ifoptionfinal{}{
        {
            \setlength{\parindent}{0em}
            \par
            \vspace{.5em}
            \textcolor{gray}{Written: #1}
            \vspace{.5em}
            \par
        }
    }
}

% Marking feedback
\newcommand{\feedback}[1]{\todo[color=blue!40]{Feedback: #1}}
\newcommand{\feedbackinline}[1]{\todo[color=blue!40,inline]{Feedback: #1}}
\newcommand{\ask}[1]{\todo[color=violet!40]{Ask: #1}}
\newcommand{\askinline}[1]{\todo[color=violet!40,inline]{Ask: #1}}



%======================================================================
% Shortcuts for specific units of measurement
%
% Built on: siunitx (with 'binary-units' option)
%
\newcommand{\gib}{\gibi\byte}
\newcommand{\mib}{\mebi\byte}
\newcommand{\kib}{\kibi\byte}



%======================================================================
% Draft-only content
%
% Built on: ifdraft
%
% These macros mark off content that should NOT appear
% in the final version of the document.
%
% If you use the 'final' option in the 'documentclass' macro:
%
%       \documentclass[final]{article}
%
% then the content will completely disappear.
%

\newcommand{\draftonlysection}[2]{
    \ifoptionfinal{%nothing
    }{
        \section*{#1 (draft only)}

        #2

        \textbf{*** This section will not be present in the final version of the document ***}
    }
}

\newcommand{\draftonlynote}[1]{
    \ifoptionfinal{%nothing
    }{
        DRAFT ONLY NOTE: #1
    }
}



%======================================================================
% Document version and history
%
% This creates a draft-only section (see above) that shows Git history of the
% document.
%
% This works by including a TeX snippet generated by the 'gen_meta_tex.sh'
% script, which is called by the Makefile during the make process.
%
% See the 'gen_meta_tex.sh' script for details of what is defined, and the
% Makefile for details of how the script is called.
%
% Note that the Git log is a separate plaintext document, 'doc-git-log.txt',
% that is also generated during the build process (see the Makefile). This is
% because of how tricky verbatim text is in LaTeX.
%
% It's much easier to print a plain text file verbatim than it is to figure out
% how to define a multi-line variable and print it verbatim.
%

\newcommand{\documenthistory}{

    \draftonlysection{Document Version and History}
    {
        Document date: \GitAuthorDate \\
        Git source version: \texttt{\GitAbrHash}
        \ifnum \GitNumDirty > 0
            , \space plus uncommitted changes to \GitNumDirty \space files
        \fi

        Recent history:
        \lstinputlisting{doc-git-log.txt}

        \ifcsname GitUrl\endcsname
            Repository URL: \\
            \GitUrl
        \fi
    }

}
